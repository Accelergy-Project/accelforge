# Lab 4 architecture: DRAM → Buffer → MAC
# ERT values from Accelergy (SRAM_metadata + regfile_metadata, 45nm).
# Source: old_labs/workspace/lab4-old/lab4.ipynb Accelergy output.
#
# BackingStorage (SRAM_metadata): 512 depth, 32-bit wide, block_size=4
#   → bits_per_action=32 (matches DRAM width=32 in Sparseloop arch)
#   → read=2.68 pJ, write=3.21 pJ per 32-bit vector access
# Buffer (regfile_metadata): 192 depth, 8-bit, 30 r/w BW
#   → bits_per_action=8 (matches Buffer width=8 in Sparseloop arch)
#   → read=1.46 pJ, write=1.46 pJ per 8-bit scalar access
# MAC (intmac, 8-bit): compute=0.56 pJ

arch:
  nodes:
  - !Memory
    name: BackingStorage
    size: 512
    leak_power: 0
    area: 0
    total_latency: "ceil((read_actions + metadata_read_actions) / 1)"
    tensors: {keep: ~Intermediates, may_keep: All}
    actions:
    - {name: read, energy: 2.68, bits_per_action: 32, latency: 0}
    - {name: write, energy: 3.21, bits_per_action: 32, latency: 0}
    - {name: metadata_read, energy: 0.85, bits_per_action: 4, latency: 0}
    - {name: metadata_write, energy: 0.85, bits_per_action: 4, latency: 0}

  - !Memory
    name: Buffer
    size: 192
    leak_power: 0
    area: 0
    total_latency: "ceil(max((read_actions + metadata_read_actions) / 30, (write_actions + metadata_write_actions) / 30))"
    tensors: {keep: ~BackingStorage, may_keep: All}
    actions:
    - {name: read, energy: 1.46, bits_per_action: 8, latency: 0}
    - {name: write, energy: 1.46, bits_per_action: 8, latency: 0}
    - {name: gated_read, energy: 0.00001, bits_per_action: 8, latency: 0}
    - {name: skipped_read, energy: 0.0, bits_per_action: 8, latency: 0}
    - {name: metadata_read, energy: 1.43, bits_per_action: 4, latency: 0}
    - {name: metadata_write, energy: 1.43, bits_per_action: 4, latency: 0}
    - {name: gated_metadata_read, energy: 0.00002, bits_per_action: 4, latency: 0}

  - !Compute
    name: MAC
    leak_power: 0
    area: 0
    actions:
    - {name: compute, energy: 0.56, latency: 1}
    - {name: gated_compute, energy: 0.03642, latency: 0}
    - {name: skipped_compute, energy: 0.0, latency: 0}
