
# Conv2 mapping for Eyeriss v1 (Table 7)
# Sparseloop factors → AccelForge tile_shapes:
# DRAM:     C=12→tile4, M=8→tile32, N=2→tile2, Q=2→tile14
# shared_glb spatial: Q=14 → 14 PEColumns
# shared_glb temporal: M=2→tile16, N=2→tile1, P=28→tile1
# DummyBuffer spatial: S=5→tile1, C=2→tile2 (10 of 12 PEs)
# weights_spad: R=5→tile1, C=2→tile1
# psum_spad: M=16→tile1

mapping:
  nodes:
  # === DRAM level ===
  - !Storage
    tensors: [Weights, Inputs, Outputs]
    component: DRAM

  # DRAM temporal (outer→inner from reversed Sparseloop permutation CMNQRSP)
  - !Temporal
    rank_variable: q
    tile_shape: 14
  - !Temporal
    rank_variable: n
    tile_shape: 2
  - !Temporal
    rank_variable: m
    tile_shape: 32
  - !Temporal
    rank_variable: c
    tile_shape: 4

  # === shared_glb level ===
  - !Storage
    tensors: [Inputs, Outputs]
    component: shared_glb

  # shared_glb spatial → 14 PEColumns (Q=14)
  - !Spatial
    rank_variable: q
    tile_shape: 1
    name: X
    component: PEColumns

  # shared_glb temporal (outer→inner: M, N, P)
  - !Temporal
    rank_variable: m
    tile_shape: 16
  - !Temporal
    rank_variable: n
    tile_shape: 1
  - !Temporal
    rank_variable: p
    tile_shape: 1

  # === DummyBuffer pass-through ===
  - !Toll
    tensors: [Inputs, Weights, Outputs]
    component: DummyBuffer

  # DummyBuffer spatial → S×C = 5×2 = 10 PEs per column
  - !Spatial
    rank_variable: s
    tile_shape: 1
    name: Y
    component: DummyBuffer
  - !Spatial
    rank_variable: c
    tile_shape: 2
    name: Y
    component: DummyBuffer

  # === PE-level storage ===
  - !Storage
    tensors: [Inputs]
    component: ifmap_spad
  - !Storage
    tensors: [Weights]
    component: weights_spad

  # weights_spad temporal (outer→inner: R, C)
  - !Temporal
    rank_variable: r
    tile_shape: 1
  - !Temporal
    rank_variable: c
    tile_shape: 1

  - !Storage
    tensors: [Outputs]
    component: psum_spad

  # psum_spad temporal: M=16
  - !Temporal
    rank_variable: m
    tile_shape: 1

  # === Compute ===
  - !Compute
    einsum: Conv
    component: MACs
