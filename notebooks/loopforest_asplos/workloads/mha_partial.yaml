# B=Batch Size
# H=#Heads
# E=Embedding per head
# D=Embedding Total
# M=Number of tokens

problem:
  # - shape:
  #     name: I
  #     dimensions: [ BI, MI, DI ]
  #     data_spaces:
  #     - name: I_n_to_I
  #       dimensions: [ I_B0, I_M0, I_D0 ]
  #       projection: '[ BI, MI, DI ]'
  #     - name: I_I_to_Q_K_V
  #       dimensions: [ I_B, I_M, I_D ]
  #       projection: '[ BI, MI, DI ]'
  #       read_write: True
  #   instance: >-
  #     0 <= BI < {B} and
  #     0 <= MI < {M} and
  #     0 <= DI < {D}

  - shape:
      name: V
      dimensions: [ BV, MV, HV, EV, DV ]
      data_spaces:
      - name: I_I_to_Q_K_V
        dimensions: [ I_B, I_M, I_D ]
        projection: '[ BV, MV, DV ]'
      - name: W_n_to_V
        dimensions: [ WV_H, WV_E, WV_D ]
        projection: '[ HV, EV, DV ]'
      - name: V_V_to_AV
        dimensions: [ V_B, V_M, V_H, V_E ]
        projection: '[ BV, MV, HV, EV ]'
        read_write: True
    instance: >-
      0 <= BV < {B} and
      0 <= MV < {M} and
      0 <= HV < {H} and
      0 <= EV < {E} and
      0 <= DV < {D}

  - shape:
      name: K
      dimensions: [ BK, MK, HK, EK, DK ]
      data_spaces:
      - name: I_I_to_Q_K_V
        dimensions: [ I_B, I_M, I_D ]
        projection: '[ BK, MK, DK ]'
      - name: W_n_to_K
        dimensions: [ WK_H, WK_E, WK_D ]
        projection: '[ HK, EK, DK ]'
      - name: K_K_to_QK
        dimensions: [ K_B, K_M, K_H, K_E ]
        projection: '[ BK, MK, HK, EK ]'
        read_write: True
    instance: >-
      0 <= BK < {B} and
      0 <= MK < {M} and
      0 <= HK < {H} and
      0 <= EK < {E} and
      0 <= DK < {D}

  - shape:
      name: Q
      dimensions: [ BQ, MQ, HQ, EQ, DQ ]
      data_spaces:
      - name: I_I_to_Q_K_V
        dimensions: [ I_B, I_M, I_D ]
        projection: '[ BQ, MQ, DQ ]'
      - name: W_n_to_Q
        dimensions: [ WQ_H, WQ_E, WQ_D ]
        projection: '[ HQ, EQ, DQ ]'
      - name: Q_Q_to_QK
        dimensions: [ Q_B, Q_M, Q_H, Q_E ]
        projection: '[ BQ, MQ, HQ, EQ ]'
        read_write: True
    instance: >-
      0 <= BQ < {B} and
      0 <= MQ < {M} and
      0 <= HQ < {H} and
      0 <= EQ < {E} and
      0 <= DQ < {D}


  - shape:
      name: QK
      dimensions: [ BQK, HQK, MQK, PQK, EQK ]
      data_spaces:
      - name: Q_Q_to_QK
        dimensions: [ Q_B, Q_M, Q_H, Q_E ]
        projection: '[ BQK, MQK, HQK, EQK ]'
      - name: K_K_to_QK
        dimensions: [ K_B, K_M, K_H, K_E ]
        projection: '[ BQK, PQK, HQK, EQK ]'
      - name: QK_QK_to_AV
        dimensions: [ QK_B, QK_M, QK_P, QK_H ]
        projection: '[ BQK, MQK, PQK, HQK ]'
        read_write: True
    instance: >-
      0 <= BQK < {B} and
      0 <= HQK < {H} and
      0 <= MQK < {M} and
      0 <= PQK < {M} and
      0 <= EQK < {E}

  - shape:
      name: AV
      dimensions: [ BAV, HAV, MAV, PAV, FAV ]
      data_spaces:
      - name: QK_QK_to_AV
        dimensions: [ QK_B, QK_M, QK_P, QK_H ]
        projection: '[ BAV, MAV, PAV, HAV ]'
      - name: V_V_to_AV
        dimensions: [ V_B, V_M, V_H, V_E ]
        projection: '[ BAV, PAV, HAV, FAV ]'
      - name: AV_AV_to_Z
        dimensions: [ AV_B, AV_M, AV_H, AV_F ]
        projection: '[ BAV, MAV, HAV, FAV ]'
        read_write: True
    instance: >-
      0 <= BAV < {B} and
      0 <= HAV < {H} and
      0 <= MAV < {M} and
      0 <= PAV < {M} and
      0 <= FAV < {E}

  - shape:
      name: Z
      dimensions: [ BZ, MZ, HZ, FZ, GZ ]
      data_spaces:
      - name: AV_AV_to_Z
        dimensions: [ AV_B, AV_M, AV_H, AV_F ]
        projection: '[ BZ, MZ, HZ, FZ ]'
      - name: W_n_to_Z
        dimensions: [ WZ_H, WZ_F, WZ_G ]
        projection: '[ HZ, FZ, GZ ]'
      - name: Z_Z_to_FFA
        dimensions: [ Z_B, Z_M, Z_G ]
        projection: '[ BZ, MZ, GZ ]'
        read_write: True
    instance: >-
      0 <= BZ < {B} and
      0 <= MZ < {M} and
      0 <= HZ < {H} and
      0 <= FZ < {E} and
      0 <= GZ < {D}

  # - shape:
  #     name: EX
  #     dimensions: [ BEX, MEX, GEX ]
  #     data_spaces:
  #     - name: Z_Z_to_EX
  #       dimensions: [ Z_B, Z_M, Z_G ]
  #       projection: '[ BEX, MEX, GEX ]'
  #     - name: EX_EX_to_LN
  #       dimensions: [ EX_B, EX_M ]
  #       projection: '[ BEX, MEX ]'
  #       read_write: True
  #   instance: >-
  #     0 <= BEX < {B} and
  #     0 <= MEX < {M} and
  #     0 <= GEX < {D}

  # - shape:
  #     name: VAR
  #     dimensions: [ BVAR, MVAR, GVAR ]
  #     data_spaces:
  #     - name: Z_Z_to_EX
  #       dimensions: [ Z_B, Z_M, Z_G ]
  #       projection: '[ BVAR, MVAR, GVAR ]'
  #     - name: VAR_VAR_to_LN
  #       dimensions: [ VAR_B, VAR_M ]
  #       projection: '[ BVAR, MVAR ]'
  #       read_write: True
  #   instance: >-
  #     0 <= BVAR < {B} and
  #     0 <= MVAR < {M} and
  #     0 <= GVAR < {D}

  # - shape:
  #     name: LN
  #     dimensions: [ BLN, MLN, GLN ]
  #     data_spaces:
  #     - name: Z_Z_to_EX
  #       dimensions: [ Z_B, Z_M, Z_G ]
  #       projection: '[ BLN, MLN, GLN ]'
  #     - name: VAR_VAR_to_LN
  #       dimensions: [ VAR_B, VAR_M ]
  #       projection: '[ BLN, MLN ]'
  #     - name: E_E_to_LN
  #       dimensions: [ E_B, E_M ]
  #       projection: '[ BLN, MLN ]'
  #     - name: LN_LN_to_FFA
  #       dimensions: [ LN_B, LN_M, LN_G ]
  #       projection: '[ BLN, MLN, GLN ]'
  #       read_write: True
  #   instance: >-
  #     0 <= BLN < {B} and
  #     0 <= MLN < {M} and
  #     0 <= GLN < {D}

  # - shape:
  #     name: FFA
  #     dimensions: [ BFFA, MFFA, GFFA, CFFA ]
  #     data_spaces:
  #     - name: Z_Z_to_FFA
  #       dimensions: [ Z_B, Z_M, Z_G ]
  #       projection: '[ BFFA, MFFA, GFFA ]'
  #     - name: WFFA
  #       dimensions: [ WFFA_G, WFFA_C ]
  #       projection: '[ GFFA, CFFA ]'
  #     - name: FFA_FFA_to_FFB
  #       dimensions: [ FFA_B, FFA_M, FFA_C ]
  #       projection: '[ BFFA, MFFA, CFFA ]'
  #       read_write: True
  #   instance: >-
  #     0 <= BFFA < {B} and
  #     0 <= MFFA < {M} and
  #     0 <= GFFA < {D} and
  #     0 <= CFFA < {C}

  # - shape:
  #     name: FFB
  #     dimensions: [ BFFB, MFFB, CFFB, JFFB ]
  #     data_spaces:
  #     - name: FFA_FFA_to_FFB
  #       dimensions: [ FFA_B, FFA_M, FFA_C ]
  #       projection: '[ BFFB, MFFB, CFFB ]'
  #     - name: WFFB
  #       dimensions: [ WFFB_C, WFFB_J ]
  #       projection: '[ CFFB, JFFB ]'
  #     - name: FFB_FFB_to_n
  #       dimensions: [ FFB_B, FFB_M, FFB_J ]
  #       projection: '[ BFFB, MFFB, JFFB ]'
  #       read_write: True
  #   instance: >-
  #     0 <= BFFB < {B} and
  #     0 <= MFFB < {M} and
  #     0 <= CFFB < {C} and
  #     0 <= JFFB < {D}
