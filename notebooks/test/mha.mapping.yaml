mapping:
  nodes:
  - {type: Storage, tensors: [I, AV, Z, FFB], memory: Global Buffer}
  - type: Split
    nodes:
    - type: Nested # Q, K, V, QK, AV
      nodes:
      - {type: Temporal, rank_variable: h, loop_bound: 1}
      - {type: Storage, tensors: [Q, K, V], memory: Global Buffer}
      - type: Split
        nodes:
        - type: Nested # Q
          nodes:
          - {type: Temporal, rank_variable: f, loop_bound: 1}
          - {type: Temporal, rank_variable: d, loop_bound: 1}
          - {type: Storage, tensors: [WV], memory: Global Buffer}
          - {type: Compute, einsum: V}
        - type: Nested # K
          nodes:
          - {type: Temporal, rank_variable: e, loop_bound: 1}
          - {type: Temporal, rank_variable: d, loop_bound: 1}
          - {type: Storage, tensors: [WK], memory: Global Buffer}
          - {type: Compute, einsum: K}
        - type: Nested # V
          nodes:
          - {type: Temporal, rank_variable: f, loop_bound: 1}
          - {type: Temporal, rank_variable: d, loop_bound: 1}
          - {type: Storage, tensors: [WQ], memory: Global Buffer}
          - {type: Compute, einsum: Q}
        - type: Nested # QK, AV
          nodes:
          - {type: Temporal, rank_variable: p, loop_bound: 1}
          - {type: Storage, tensors: [QK], memory: Global Buffer}
          - type: Split
            nodes:
            - {type: Compute, einsum: QK}
            - {type: Compute, einsum: AV}

    - type: Nested # Z
      nodes: 
      - {type: Temporal, rank_variable: h, loop_bound: 1}
      - {type: Temporal, rank_variable: f, loop_bound: 1}
      - {type: Temporal, rank_variable: g, loop_bound: 1}
      - {type: Storage, tensors: [WZ], memory: Global Buffer}
      - {type: Compute, einsum: Z}

    - type: Nested  # FFA, FFB
      nodes:
      - {type: Temporal, rank_variable: nFFA, loop_bound: 1}
      - {type: Storage, tensors: [FFA], memory: Global Buffer}
      - type: Split
        nodes:
        - type: Nested # FFA
          nodes:
          - {type: Temporal, rank_variable: g, loop_bound: 1}
          - {type: Storage, tensors: [WFFA], memory: Global Buffer}
          - {type: Compute, einsum: FFA}
        - type: Nested # FFB
          nodes:
          - {type: Temporal, rank_variable: nFFB, loop_bound: 1}
          - {type: Storage, tensors: [FFB], memory: Global Buffer}
          - {type: Compute, einsum: FFB}


# """
# Storage(I, AV, Z, FFB)
# split
# - for h
#   Storage(Q, K, V)
#   split
#   - for f
#     for d
#     Storage(WV)
#     Einsum V
#   - for e
#     for d
#     Storage(WK)
#     Einsum K
#   - for e
#     for d
#     Storage(WQ)
#     Einsum Q
#   - for p
#     Storage(QK)
#     split:
#     - Einsum QK
#     - Einsum AV
# - for h
#   for f
#   for g
#   Storage(WZ)
#   Einsum Z
# - for nFFA
#   Storage(FFA)
#   split
#   - for g
#     Storage(WFFA)
#     Einsum FFA
#   - for nFFB
#     Storage(FFB)
#     Einsum FFB
# """
