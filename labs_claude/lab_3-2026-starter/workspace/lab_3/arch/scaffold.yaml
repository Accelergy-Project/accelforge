arch:
  # version: "0.5"
  nodes:
  - !Memory
    name: DRAM
    size: inf
    total_latency: (read_actions + write_actions) / ({{ DRAM_BW }}*8e9)
    leak_power: 0
    area: 0 # Don't include off-chip DRAM area
    actions:
    - {name: read, energy: 8e-12, latency: 0}
    - {name: write, energy: 8e-12, latency: 0}
    tensors: {keep: ~Intermediates, may_keep: All}

  {% for memory_level in memory_hierarchy %}
  - !Memory
    name: {{ memory_level.name }}
    component_class: SRAM
    size: {{ memory_level.capacity }}*8
    total_latency: (read_actions + write_actions) / ({{ memory_level.bandwidth }}*8e9)
    tensors: {keep: {{ memory_level.keep }}, may_keep: {{ memory_level.keep }}}
    leak_power: 0
    extra_attributes_for_component_model:
      tech_node: 32e-9
      width: {{ memory_level.bandwidth }}*8
      depth: {{ memory_level.capacity }} / ({{ memory_level.bandwidth }})
    actions:
    - {name: read}
    - {name: write}
  {% endfor %}

  - !Memory
    name: RF
    component_class: aladdinregister
    size: {{ rf_capacity }}*8
    tensors: {keep: weight, may_keep: All}
    total_latency: (read_actions + write_actions) / 32e9
    spatial:
    - name: X
      fanout: {{ array_x }}
      reuse: output
    - name: Y
      fanout: {{ array_y }}
      reuse: input
    leak_power: 0
    extra_attributes_for_component_model:
      tech_node: 32e-9
      width: 32
      depth: {{ rf_capacity }} / 4
  - !Compute
    name: MAC
    leak_power: 0
    area: 9e-11 # 90 um^2. Very rough estimate based on die photo.
    actions:
    - {name: compute, energy: 0.084e-12, latency: 1e-9}