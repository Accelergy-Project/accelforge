arch:
  # version: "0.5"
  nodes:
  - !Memory
    name: DRAM
    size: inf
    total_latency: (read_actions + write_actions) / (8 * 614e9) # 614 GB/s
    leak_power: 0
    area: 0 # Don't include off-chip DRAM area
    actions:
      # Upper end of the range from the TPU paper. The lower end came from their
      # reference, and they said it left out some things.
    - {name: read, energy: 7.03e-12, latency: 0}
    - {name: write, energy: 7.03e-12, latency: 0}
    tensors: {keep: ~Intermediates, may_keep: All}

  - !Memory
    name: GLB
    size: {{ GLB_SIZE }}
    # 2GB/s read, 1GB/s write
    total_latency: max(read_actions / 8 / 2048e9, write_actions / 8 / 1024e9)
    leak_power: 0
    area: 112e-6 # 112 mm^2
    actions:
    - {name: read, energy: 1.88e-12, latency: 0}
    - {name: write, energy: 2.36e-12, latency: 0}
    tensors: {keep: ~DRAM.tensors, may_keep: All}

  - !Compute
    name: MAC
    total_latency: compute_actions / 1e9
    leak_power: 0
    area: 9e-11 # 90 um^2. Very rough estimate based on die photo.
    actions:
    - {name: compute, energy: 0.084e-12, latency: 0}