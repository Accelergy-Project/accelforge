arch:
  version: "0.5"
  nodes:
  - !Memory
    name: DRAM
    size: inf
    latency: (read_actions + write_actions) / (8 * 614e9) # 614 GB/s
    leak_power: 0
    area: 0 # Don't include off-chip DRAM area
    actions:
      # Upper end of the range from the TPU paper. The lower end came from their
      # reference, and they said it left out some things.
    - {name: read, energy: 7.03e-12, latency: 0}
    - {name: write, energy: 7.03e-12, latency: 0}
    constraints: {tensors: {keep: ~Intermediates, may_keep: All}}

  - !Fanout
    name: Array
    spatial:
    - {name: reuse_input, fanout: 128, reuse: input} # 8 is the datawidth
    - {name: reuse_output, fanout: 128, reuse: output}
    constraints:
      tensors: {keep: Nothing}
      spatial:
      - {name: reuse_input, must_reuse: input, min_utilization: 1}
      - {name: reuse_output, must_reuse: output, min_utilization: 1}

  - !Compute
    name: MAC
    attributes:
      _latency: compute_actions / 1.05e9
      _leak_power: 0
      _area: 9e-11 # 90 um^2. Very rough estimate based on die photo.
    actions:
    - {name: compute, energy: 0.084e-12, latency: 0}
    constraints: {misc: {enabled: len(All) == 3}}